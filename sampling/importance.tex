\section{Importance sampling}

Assume that we can sample from a proposal distribution $q$ with a pdf $q(\vec x)$, which can be evaluated only up to a constant of proportionality (i.e. we can only evaluate $q^\ast(\vec x) = Z_q q(\vec x)$). To solve problem 2, we follow
\begin{enumerate}
    \item Generate samples from $q$, $\{\vec x^{(r)}\}$.
    \item Calculate importance weights $w_r = \frac{p^\ast(\vec x^{(r)})}{q^\ast(\vec x^{(r)})}$.
    \item $\hat{\vec y} = \frac{\sum_r w_r f(\vec x^{(r)})}{\sum_r w_r}$ is the estimator of $\E[f(\vec X)]$.
\end{enumerate}

\subsection{Convergence of estimator as $R$ increases}
    We want to prove that if $q(\vec x)$ is non-zero for all $\vec x$ where $p(\vec x)$ is non-zero, the estimator $\hat{\vec y}$ converges to $\E[f(\vec X)]$, as $R$ increases. We consider the the expectations of the numerator and denominator separately:
    \begin{align}
        \E_q[\text{numer}]  &= \E_q\left[\sum_r w_r f(\vec x^{(r)})\right] \\
                            &= \sum_r \E_q\left[w_r f(\vec x^{(r)})\right] \\
                            &= \sum_r \E_q\left[\frac{p^\ast(\vec x^{(r)})}{q^\ast(\vec x^{(r)})} f(\vec x^{(r)})\right] \\
                            &= \sum_r \E_q\left[\frac{Z_p p(\vec x^{(r)})}{Z_q q(\vec x^{(r)})} f(\vec x^{(r)})\right] \\
                            &= \frac{Z_p}{Z_q} \sum_r \int_{\vec x^{(r)}} p(\vec x^{(r)}) f(\vec x^{(r)}) \, \mathrm d \vec x^{(r)} \\
                            &= \frac{Z_p}{Z_q} \sum_r \E_p\left[f(\vec x^{(r)})\right] \\
                            &= \frac{Z_p}{Z_q} R \E_p\left[f(\vec x)\right] \\
        \E_q[\text{denom}]  &= \E_q\left[\sum_r w_r\right] \\
                            &= \sum_r \E_q\left[\frac{p^\ast(\vec x^{(r)})}{q^\ast(\vec x^{(r)})}\right] \\
                            &= \sum_r \E_q\left[\frac{Z_p p(\vec x^{(r)})}{Z_q q(\vec x^{(r)})}\right] \\
                            &= \frac{Z_p}{Z_q} \sum_r \int_{\vec x^{(r)}} p(\vec x^{(r)}) \,\mathrm d \vec x^{(r)} \\
                            &= \frac{Z_p}{Z_q} R
    \end{align}

    Hence $\hat{\vec y}$ converges to $\E_p[f(\vec x)]$ as $R$ increases (but is not necessarily an unbiased estimator because $\E_q[\hat{\vec y}]$ is not necessarily $= \E_p[f(\vec x)]$).